# BlockSpin Appeals Portal (Railway)

Lightweight FastAPI service to collect Discord ban appeals via OAuth and pipe them into the moderation flow.

## Features
- Discord OAuth2 (identify) to ensure user identity.
- Checks for an active guild ban before showing the appeal form.
- Submits an appeal embed with action buttons to the mod channel (`APPEAL_CHANNEL_ID`).
- Moderators (role `MODERATOR_ROLE_ID`) can Accept/Decline via buttons.
  - Accept: logs, unbans, DMs the user, removes the original appeal message.
  - Decline: logs and DMs the user; message is updated to show the decision.
- Interaction signature verification for the `/interactions` endpoint.

## Environment variables
- `DISCORD_CLIENT_ID`, `DISCORD_CLIENT_SECRET`, `DISCORD_REDIRECT_URI` (e.g. `https://bs-appeals.up.railway.app/callback`)
- `DISCORD_BOT_TOKEN` (bot token with `View Audit Log`/`Ban` perms)
- `DISCORD_PUBLIC_KEY` (from the Discord developer portal)
- `TARGET_GUILD_ID` (server to check bans against)
- `MODERATOR_ROLE_ID` (role allowed to handle appeals) – default `1353068159346671707`
- `APPEAL_CHANNEL_ID` (where appeals are posted) – default `1352973388334764112`
- `APPEAL_LOG_CHANNEL_ID` (accept/decline audit log) – default `1353445286457901106`
- `PORTAL_SECRET_KEY` (session signing; autogenerated if omitted)
- Optional: `PORT` (defaults to 8000 on local)

## Running locally
```bash
python -m venv .venv && . .venv/bin/activate
pip install -r web_portal/requirements.txt
cd web_portal
uvicorn main:app --reload --port 8000
```
Visit `http://localhost:8000` to start the OAuth flow.

## Deploy (Railway)
- Set the env vars above.
- Set the start command to `uvicorn web_portal.main:app --host 0.0.0.0 --port $PORT`.
- Point the Discord OAuth redirect to `https://bs-appeals.up.railway.app/callback`.
